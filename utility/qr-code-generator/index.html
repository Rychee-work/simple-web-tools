<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QR Code Generator — Simple Web Tools</title>
  <meta name="description" content="Generate QR codes locally in your browser and download as PNG. No uploads." />
  <link rel="canonical" href="https://simple-web-tools.com/utility/qr-code-generator/" />
  <link rel="stylesheet" href="/assets/css/styles.css" />

  <!-- AdSense: tool pages only -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5493851170081090"
    crossorigin="anonymous"></script>

  <!-- Common UI helper -->
  <script defer src="/assets/js/tools-ui.js"></script>

  <!-- ✅ QR library loader: LOCAL first -> (optional) CDN fallback -->
  <script>
    (function () {
      function loadScript(src) {
        return new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = src;
          s.onload = resolve;
          s.onerror = reject;
          document.head.appendChild(s);
        });
      }

      // This page uses "qrcode-generator" style global: window.qrcode(typeNumber, ecLevel)
      window.__ensureQRCodeLib = async function () {
        if (typeof window.qrcode === "function") return true;

        // 1) Local vendor (recommended, works offline)
        try {
          await loadScript("/assets/js/vendor/qrcode-generator.js");
        } catch (_) {}

        if (typeof window.qrcode === "function") return true;

        // 2) Optional CDN fallback (only if you want)
        // try { await loadScript("https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/dist/qrcode.js"); } catch (_) {}
        // return (typeof window.qrcode === "function");

        return false;
      };
    })();
  </script>

  <style>
    .tool-grid.pg-stack { grid-template-columns: 1fr !important; }
    .tool-grid.pg-stack > .card { margin-bottom: 16px; }

    .form-row { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .control {
      height:40px; padding:0 10px;
      border-radius:12px; border:1px solid var(--border);
      background:#fff; color:var(--text);
      font-weight:800;
    }
    .small-muted{ color:var(--muted); font-weight:700; font-size:13px; }

    .preview-wrap{
      display:grid;
      place-items:center;
      padding:14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
    }
    #qrCanvas{ display:block; width:100%; max-width:320px; height:auto; }

    .meta-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    .meta{
      border:1px solid var(--border);
      background:#fff;
      border-radius:12px;
      padding:10px 12px;
    }
    .meta .k{ color:var(--muted); font-weight:800; font-size:12px; }
    .meta .v{ font-weight:900; margin-top:4px; }

    @media (max-width: 520px){
      .meta-grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="sidebar-overlay" data-sidebar-overlay></div>

  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo" aria-label="Simple Web Tools logo">ST</div>
        <div>
          <div>Simple Web Tools <span class="badge">beta</span></div>
          <div class="tagline">Fast, simple, private</div>
        </div>
      </div>

      <nav class="nav" aria-label="Legal">
        <a href="/legal/privacy.html">Privacy</a>
        <a href="/legal/terms.html">Terms</a>
        <a href="/legal/contact.html">Contact</a>
      </nav>

      <button class="menu-btn" type="button" aria-label="Open menu" data-menu-btn>
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </header>

  <main class="container">
    <div class="layout">

      <aside class="sidebar" data-sidebar>
        <div class="card">
          <div class="section-title">
            <h2>Categories</h2>
            <span class="hint">Browse</span>
          </div>
          <div class="cat-list" data-cat-list>
            <a class="cat" href="/pdf/"><span>PDF</span><small>Tools</small></a>
            <a class="cat" href="/image/"><span>Image</span><small>Tools</small></a>
            <a class="cat" href="/text/"><span>Text</span><small>Tools</small></a>
            <a class="cat" href="/math/"><span>Math</span><small>Tools</small></a>
            <a class="cat" href="/utility/"><span>Utility</span><small>Tools</small></a>
            <a class="cat" href="/developer/"><span>Developer</span><small>Tools</small></a>
            <a class="cat" href="/ai-fun/"><span>AI Fun</span><small>Tools</small></a>
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <div class="section-title">
            <h2>Support</h2>
            <span class="hint">Ads</span>
          </div>
          <div class="ad-slot" style="height:120px">Ad space</div>
          <p class="small-muted" style="margin:10px 0 0">Ads appear after approval. Tools work without uploads.</p>
        </div>
      </aside>

      <section class="main">

        <div class="hero">
          <div class="breadcrumbs">
            <a href="/">All tools</a> &nbsp;›&nbsp; <a href="/utility/">Utility</a> &nbsp;›&nbsp; <span>QR Code Generator</span>
          </div>
          <h1>QR Code Generator</h1>
          <p>
            Generate QR codes locally in your browser and download as PNG.
            Supports URLs and text. No uploads.
          </p>
          <div class="note">
            Tip: Error “M” is a good default. Increase to “Q/H” for printing.
          </div>
        </div>

        <div class="grid">
          <div class="ad-slot">Ad space (below hero)</div>
        </div>

        <div class="grid">
          <div class="tool-grid pg-stack">

            <!-- 1) Options -->
            <div class="card">
              <div class="section-title">
                <h2>1) Options</h2>
                <span class="hint">Customize</span>
              </div>

              <label class="label" for="text">Text / URL</label>
              <textarea class="textarea" id="text" rows="6" placeholder="https://example.com"></textarea>

              <div class="form-row" style="margin-top:12px">
                <label for="size" style="font-weight:800">Size</label>
                <input id="size" class="control" type="number" min="128" max="1024" value="256" style="width:110px" />
                <span class="small-muted">px</span>

                <label for="ec" style="font-weight:800; margin-left:6px;">Error</label>
                <select id="ec" class="control" style="width:120px">
                  <option value="L">L</option>
                  <option value="M" selected>M</option>
                  <option value="Q">Q</option>
                  <option value="H">H</option>
                </select>

                <label for="margin" style="font-weight:800; margin-left:6px;">Margin</label>
                <input id="margin" class="control" type="number" min="0" max="10" value="2" style="width:90px" />
              </div>

              <div class="row wrap" style="margin-top:14px">
                <button id="gen" class="btn primary action" type="button">Generate</button>
                <button id="download" class="btn action" type="button">Download PNG</button>
                <button id="clear" class="btn action" type="button">Clear</button>
              </div>

              <p class="small-muted" style="margin-top:12px">
                No upload. Everything runs in your browser.
              </p>
              <p class="small-muted" id="status" style="margin-top:6px">Status: Ready.</p>
            </div>

            <!-- 2) Result -->
            <div class="card">
              <div class="section-title">
                <h2>2) Result</h2>
                <span class="hint">Preview</span>
              </div>

              <div class="preview-wrap">
                <canvas id="qrCanvas" width="256" height="256"></canvas>
              </div>

              <div class="meta-grid">
                <div class="meta"><div class="k">Input length</div><div class="v" id="metaLen">0</div></div>
                <div class="meta"><div class="k">Rendered size</div><div class="v" id="metaSize">256 × 256</div></div>
                <div class="meta"><div class="k">Error correction</div><div class="v" id="metaEC">M</div></div>
                <div class="meta"><div class="k">Margin</div><div class="v" id="metaMargin">2</div></div>
              </div>

              <div class="note" style="margin-top:12px">
                Result shows the QR preview and the applied settings. Download exports exactly what you see.
              </div>
            </div>

          </div>

          <div class="card">
            <div class="section-title">
              <h2>FAQ</h2>
              <span class="hint">Help</span>
            </div>
            <p class="desc"><b>Why is my PNG blank?</b><br/>It happens when QR drawing fails (library missing / input empty). This page shows an error on the preview and blocks blank downloads.</p>
          </div>

          <div class="ad-slot">Ad space (below tool)</div>
        </div>

        <script>
          const $ = (id) => document.getElementById(id);

          const textEl = $("text");
          const sizeEl = $("size");
          const ecEl = $("ec");
          const marginEl = $("margin");
          const canvas = $("qrCanvas");
          const ctx = canvas.getContext("2d");

          const metaLen = $("metaLen");
          const metaSize = $("metaSize");
          const metaEC = $("metaEC");
          const metaMargin = $("metaMargin");
          const status = $("status");

          let lastRenderOk = false;

          function setStatus(msg){ status.textContent = "Status: " + msg; }
          function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }

          function paintBackground(){
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0,0,canvas.width,canvas.height);
          }

          function drawErrorOnCanvas(message){
            ctx.clearRect(0,0,canvas.width,canvas.height);
            paintBackground();
            ctx.strokeStyle = "#e5e7eb";
            ctx.lineWidth = 2;
            ctx.strokeRect(1,1,canvas.width-2,canvas.height-2);

            ctx.fillStyle = "#111827";
            ctx.font = "bold 16px system-ui, -apple-system, Segoe UI, Roboto, Arial";
            ctx.fillText("QR render failed", 14, 34);
            ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
            const lines = String(message || "").slice(0,180).match(/.{1,34}/g) || [];
            lines.slice(0,7).forEach((ln,i)=> ctx.fillText(ln, 14, 60 + i*18));
          }

          function renderQRToCanvas(qr, sizePx, quietModules){
            // qr is "qrcode-generator" instance
            const count = qr.getModuleCount();

            // total modules including quiet zone (margin)
            const total = count + quietModules * 2;

            // cell size (integer) + centered
            const cell = Math.max(1, Math.floor(sizePx / total));
            const renderSize = cell * total;
            const offset = Math.floor((sizePx - renderSize) / 2);

            // clear + white
            ctx.clearRect(0,0,sizePx,sizePx);
            paintBackground();

            // draw modules
            ctx.fillStyle = "#000000";
            for (let r = 0; r < count; r++){
              for (let c = 0; c < count; c++){
                if (qr.isDark(r,c)){
                  const x = offset + (c + quietModules) * cell;
                  const y = offset + (r + quietModules) * cell;
                  ctx.fillRect(x, y, cell, cell);
                }
              }
            }
          }

          async function generate(){
            lastRenderOk = false;

            const ok = await window.__ensureQRCodeLib();
            if (!ok){
              setStatus("QR library not loaded. Put /assets/js/vendor/qrcode-generator.js");
              drawErrorOnCanvas("Missing vendor JS: /assets/js/vendor/qrcode-generator.js");
              return;
            }

            const text = (textEl.value || "").trim();
            const size = clamp(Number(sizeEl.value || 256), 128, 1024);
            const ec = (ecEl.value || "M").toUpperCase();
            const margin = clamp(Number(marginEl.value || 2), 0, 10);

            metaLen.textContent = String(text.length);
            metaSize.textContent = size + " × " + size;
            metaEC.textContent = ec;
            metaMargin.textContent = String(margin);

            canvas.width = size;
            canvas.height = size;

            if (!text){
              setStatus("Ready. (input is empty)");
              drawErrorOnCanvas("Input is empty.");
              return;
            }

            try{
              // qrcode(typeNumber, errorCorrectionLevel)
              // typeNumber = 0 => auto
              const qr = window.qrcode(0, ec);
              qr.addData(text, "Byte");
              qr.make();

              renderQRToCanvas(qr, size, margin);

              lastRenderOk = true;
              setStatus("Generated.");
            }catch(e){
              console.error(e);
              setStatus("Failed to generate.");
              drawErrorOnCanvas(e && e.message ? e.message : String(e));
            }
          }

          function downloadPng(){
            if (!lastRenderOk){
              setStatus("Download blocked (QR not generated).");
              return;
            }
            canvas.toBlob((blob) => {
              if (!blob){ setStatus("Download failed."); return; }
              const a = document.createElement("a");
              const url = URL.createObjectURL(blob);
              a.href = url;
              a.download = "qr.png";
              document.body.appendChild(a);
              a.click();
              a.remove();
              URL.revokeObjectURL(url);
              setStatus("Downloaded PNG.");
            }, "image/png");
          }

          function clearAll(){
            textEl.value = "";
            setStatus("Cleared.");
            generate();
          }

          $("gen").addEventListener("click", generate);
          $("download").addEventListener("click", downloadPng);
          $("clear").addEventListener("click", clearAll);

          let t = null;
          function schedule(){
            clearTimeout(t);
            t = setTimeout(generate, 180);
          }
          textEl.addEventListener("input", schedule);
          sizeEl.addEventListener("input", schedule);
          ecEl.addEventListener("change", schedule);
          marginEl.addEventListener("input", schedule);

          // init
          textEl.value = "https://simple-web-tools.com/";
          generate();
        </script>

      </section>
    </div>
  </main>
</body>
</html>
